---
title: "BiomeBGC_dataPrep"
author: 
  - Dominique Caron
  - CÃ©line Boisvenue
date: "February 2026"
output:
  html_document:
    keep_md: yes
bibliography: citation.bib
editor_options:
  chunk_output_type: console
---



# Overview

Retrieves and prepares the input to run Biome-BGC version 4.2 through the module `BiomeBGC_core`.

# Parameters

Provide a summary of user-visible parameters.


|paramName            |paramClass |default      |min |max |paramDesc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|:--------------------|:----------|:------------|:---|:---|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|carbonState          |numeric    |0.001, 0.... |NA  |NA  |11-number vector for initial carbon conditions: 1: peak leaf carbon to be attained during the first simulation year (kgC/m2) 2: peak stem carbon to be attained during the first year (kgC/m2) 3: initial coarse woody debris carbon (dead trees, standing or fallen) (kgC/m2) 4: initial litter carbon, labile pool (kgC/m2) 5: initial litter carbon, unshielded cellulose pool (kgC/m2) 6: initial litter carbon, shielded cellulose pool (kgC/m2) 7: initial litter carbon, lignin pool (kgC/m2) 8: soil carbon, fast pool (kgC/m2) 9: soil carbon, medium pool (kgC/m2) 10: soil carbon, slow pool (kgC/m2) 11: soil carbon, slowest pool (kgC/m2) |
|climModel            |character  |RCM4         |NA  |NA  |A climatic model to extract meteorological data. Either 'RCM4', 'GCM4', or 'Hadley'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|climateChangeOptions |numeric    |0, 0, 1,.... |NA  |NA  |Entries in the CLIMATE_CHANGE section of the ini file. The entries are: offset for Tmax, offset for Tmin multiplier for prcp, multiplier for vpd, and muliplier for srad.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|co2scenario          |character  |RCP45        |NA  |NA  |An representative concentration pathway for the co2 concentration trajectories and meteorological data. Either 'RCP45' or 'RCP85'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|maxSpinupYears       |integer    |6000         |NA  |NA  |The maximum number of simulation for a spinup run.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|metSpinupYears       |numeric    |40           |NA  |NA  |The number of years used for the spinup.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|NDepositionLevel     |numeric    |1, NA, NA    |NA  |NA  |A 3-number vector: 1) Keep nitrogen deposition level constant (0) or vary according to the time trajectory of CO2 mole fractions (1). 2) The reference year for N deposition (only used when N-deposition varies). 3) Industrial N deposition value.                                                                                                                                                                                                                                                                                                                                                                                                    |
|nitrogenState        |numeric    |0, 0         |NA  |NA  |2-number vector for initial nitrogen conditions: 1: litter nitrogen associated with labile litter carbon pool (kgN/m2) 2: soil mineral nitrogen pool (kgN/m2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|outputVariables      |numeric    |0, 3, 54.... |NA  |NA  |The indices of the daily output variable(s) requested. There are >500 possible variables and are listed here: https://raw.githubusercontent.com/PredictiveEcology/BiomeBGCR/refs/heads/development/src/Biome-BGC/src/bgclib/output_map_init.c. The units of each variable are found here: https://raw.githubusercontent.com/PredictiveEcology/BiomeBGCR/refs/heads/development/src/Biome-BGC/src/include/bgc_struct.h.                                                                                                                                                                                                                                  |
|siteConstants        |numeric    |1, NA, N.... |NA  |NA  |A vector with site information: 1: effective soil depth 2: sand percentage 3: silt percentage 4: clay percentage 5: site elevation in meters 6: site latitude in decimal degrees 7: site shortwave albedo 8: annual rate of atmospheric nitrogen deposition 9: annual rate of symbiotic+asymbiotic nitrogen fixation The non-na constants will be retrieved in various sources.                                                                                                                                                                                                                                                                         |
|siteNames            |character  |site1        |NA  |NA  |The names of the study sites.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|waterState           |numeric    |NA, 0.5      |NA  |NA  |2-number vector for initial water conditions: 1: initial snowpack water content (kg/m2) 2: intial soil water content as a proportion of saturation (DIM) If set to NA, the initial snowpack water content will be retrieved by an external source.                                                                                                                                                                                                                                                                                                                                                                                                      |
|.plots               |character  |screen       |NA  |NA  |Used by Plots function, which can be optionally used here                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|.plotInitialTime     |numeric    |0            |NA  |NA  |Describes the simulation time at which the first plot event should occur.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|.plotInterval        |numeric    |NA           |NA  |NA  |Describes the simulation time interval between plot events.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|.saveInitialTime     |numeric    |NA           |NA  |NA  |Describes the simulation time at which the first save event should occur.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|.saveInterval        |numeric    |NA           |NA  |NA  |This describes the simulation time interval between save events.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|.studyAreaName       |character  |NA           |NA  |NA  |Human-readable name for the study area used - e.g., a hash of the studyarea obtained using `reproducible::studyAreaName()`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|.seed                |list       |             |NA  |NA  |Named list of seeds to use for each event (names).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|.useCache            |logical    |FALSE        |NA  |NA  |Should caching of events or module be used?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

# Events

Describe what happens for each event type.

## Plotting

Write what is plotted.

## Saving

Write what is saved.

# Data dependencies

## Input data

Input data are parameters driving Biome-BGC. The default input data are from various sources, scale, and precision level. We calibrated default ecophysiological constants for Canadian tree species by aggregating data from @white_parameterization_2000, @hessl_ecophysiological_2004, and TRY plant Trait database [kattge_try_2020]. Meteorological data are retrieved through the BioSIM package [@fortin_web_2022, @fortin_package_2022]. Site-level parameters are extracted from the various sources:

- Dominant species: NTEMS dominant species layers for the 1st year of the simulation [@hermosilla_characterizing_2024].
- Elevation: AWS Open Data Terrain Tiles extracted with the elevatr package [@hollister_elevatr_2025].
- N deposition: Extracted from @zhu_changing_2025.
- N fixation rate: Extracted from @reis_ely_global_2025.
- Snow pack water content: Canada monthly snow water equivalent (SWE) for January [@mudryk_characterization_2015].
- Soil depth: The maximum soil depth layer of NACP MsTMIP: Unified North American Soil Map [@liu_north_2014].
- Soil texture: Soil Landscape Grids of Canada [@geng_100_2025].



|objectName                |objectClass |desc                                                                                                                                                                                                                                                                                               |sourceURL                                                                                    |
|:-------------------------|:-----------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------|
|climatePolygons           |SpatVector  |Polygons of homogeneous climate. By default, ecodistricts are used.                                                                                                                                                                                                                                |NA                                                                                           |
|CO2concentration          |data.frame  |CO2 concentration for each year.                                                                                                                                                                                                                                                                   |NA                                                                                           |
|dominantSpecies           |SpatRaster  |A raster with the leading tree species (speciesId). Use to determine the ecophysiological constants. By default, the NTEMS dominant tree species layer for the starting year is used.                                                                                                              |NA                                                                                           |
|ecophysiologicalConstants |data.frame  |Ecophysiological constants. Columns are speciesId, species, PFT, and the ecological constants (see template). By default, ecophysiologicalConstants are extracted from White et al., 2000, Hessl et al., 2004, and TRY.                                                                            |NA                                                                                           |
|elevation                 |SpatRaster  |An elevation (m) raster. By default, the raster will be extracted from AWS Terrain Tiles with the elevatr package.                                                                                                                                                                                 |https://registry.opendata.aws/terrain-tiles/                                                 |
|meteorologicalData        |list        |List of data.frames with the meteorological data for each climate polygons. The units are `deg C` for Tmax, Tmin, and Tday, `cm` for prcp, `Pa` for VPD, `W/m^2` for srad, and `s` for daylen.                                                                                                     |NA                                                                                           |
|Ndeposition               |SpatRaster  |Raster(s) of total atmospheric N deposition (kgN/m2/yr). If N deposition is variable two layers need to be provided, one for N deposition at the start, of the simulation and a second for N deposition at another timestep. The layer name of the second raster needs to be the year of the data. |https://www.nature.com/articles/s41467-024-55606-y                                           |
|NFixationRates            |SpatRaster  |Raster of annual rate of symbiotic + asymbiotic nitrogen fixation (kgN/m2/yr).                                                                                                                                                                                                                     |https://www.sciencebase.gov/catalog/item/66a97480d34e07a119db3a37                            |
|rasterToMatch             |SpatRaster  |A raster defining the extent, resolution, projection of the study area. The user needs to provide the rasterToMatch if the studyArea is a polygon.                                                                                                                                                 |NA                                                                                           |
|snowpackWaterContent      |SpatRaster  |Initial snowpack water content (kg/m2).                                                                                                                                                                                                                                                            |https://climate-scenarios.canada.ca/?page=blended-snow-data                                  |
|soilDepth                 |SpatRaster  |A raster of effective soil depth (rooting zone depth) in m.                                                                                                                                                                                                                                        |https://www.earthdata.nasa.gov/data/catalog/ornl-cloud-nacp-mstmip-unified-na-soilmap-1242-1 |
|soilTextures              |SpatRaster  |A raster stack with layers representing the % of 'Sand', 'Silt', and 'Clay'. The across-layers sum needs to equal to 1 for each pixels.                                                                                                                                                            |https://sis.agr.gc.ca/cansis/nsdb/psm/index.html                                             |
|sppEquiv                  |data.frame  |A data frame to link the leading species map to ecophysiological constants. The columns are speciesId, species, genus, functional plant type.                                                                                                                                                      |NA                                                                                           |
|studyArea                 |SpatVector  |Polygons to use as the study area. Must be supplied by the user. One polygon per study site.                                                                                                                                                                                                       |NA                                                                                           |

## Output data

Description of the module outputs.


|objectName           |objectClass |desc                                                                                                |
|:--------------------|:-----------|:---------------------------------------------------------------------------------------------------|
|bbgcSpinup.ini       |character   |Biome-BGC initialization files for the spinup. Path to the .ini files (one path per site/scenario). |
|bbgc.ini             |character   |Biome-BGC initialization files. Path to the .ini files (one path per site/scenario).                |
|pixelGroupMap        |SpatRaster  |                                                                                                    |
|pixelGroupParameters |data.frame  |                                                                                                    |

# Links to other modules

Prepares inputs for `BiomeBGC_core`.

# References

